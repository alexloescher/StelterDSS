@model Ingeniux.Runtime.ICMSEnvironment
@using Ingeniux.Runtime
@using System.Text.RegularExpressions
@{
    CMSPageRequest page = Model as CMSPageRequest;
    ICMSElement siteControl = page != null ? page.Element("CSiteControl") : null;
}
<!DOCTYPE html>
<html lang="en">
<head>
    @{
        if (Request.QueryString["debug"] != null)
        {
        <!-- Original request url:  @Request.Url.ToString() -->   
        }
    }

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    @{		
        if (!(page != null && page.IsPreview))
        {
            string protocol = Request.IsSecureConnection ? "https:" : "http:";
            <base href="@protocol//@Request.Url.Host/" />
        }
        string title = page.GetElementValue("BrowserBarTitle");
        string copytitle = ViewBag.Title;
        if (siteControl != null && String.IsNullOrEmpty(title))
        {
            string orgName = siteControl.GetElementValue("OrgName");
            if (!orgName.IsNullOrEmpty())
            {
                title = orgName;
                if (!copytitle.IsNullOrEmpty())
                {
                    title = copytitle + " | " + title;
                }
            }
        }
        if (page.MobileDeviceInformation != null && page.MobileDeviceInformation.IsTablet)
        {
            //add a viewport width just for tablets
        <meta name="viewport" content="width=device-width" />
        }
    }
    <!-- Title should be OrgName | Page Title | Main Copy Title -->
    <!-- Example: Drake University | Planned Giving | Bequests and Wills -->
    <title>@title</title>
    @{
        Html.RenderPartial("Other/SEO", page, new ViewDataDictionary(title));
        if (siteControl != null)
        {
        <script type="text/javascript">
            //Setting global variables
            var orgId = "@siteControl.GetElementValue("OrgID")";        
        </script>
        
        @Html.Raw(siteControl.GetElementValue("BeginningHeadTagHTML"))
        }
        <link rel="stylesheet" type="text/css" href="@_Functions.GetPrebuiltPath("prebuilt/css/stelter-master.css", Url, page)" />
        <link rel="stylesheet" type="text/css" href="@_Functions.GetPrebuiltPath("prebuilt/css/stelter-print.css", Url, page)" media="print" />
        <link rel="stylesheet" type="text/css" href="@_Functions.GetPrebuiltPath("prebuilt/css/stelter-journey.css", Url, page)"/>        
        <script type="text/javascript" src="@_Functions.GetPrebuiltPath("prebuilt/js/jquery.js", Url, page)"></script>
        <script type="text/javascript" src="@_Functions.GetPrebuiltPath("prebuilt/js/jquery-popup.js", Url, page)"></script>
        <script type="text/javascript" src="@_Functions.GetPrebuiltPath("prebuilt/js/jquery.magnific-popup.min.js", Url, page)"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.js"></script>
        <link type="text/css" rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" />
        <script type="text/javascript" src="@_Functions.GetPrebuiltPath("prebuilt/js/jquery-scripts.js", Url, page)"></script>
        <script type="text/javascript" src="@_Functions.GetPrebuiltPath("prebuilt/js/s_code.js", Url, page)"></script>

        if (siteControl != null)
        {
            foreach (ICMSLinkElement csslnk in siteControl.Elements("Page", "CSSLink"))
            {
        <link rel="Stylesheet" href="@csslnk.URL@(Model.IsPreview ? "?date=" + DateTime.Now.Ticks : "")" />
            }
            foreach (ICMSLinkElement jslnk in siteControl.Elements("Page", "JSLink"))
            {
        <script type="text/javascript" src="@jslnk.URL@(Model.IsPreview ? "?date=" + DateTime.Now.Ticks : "")"></script>
            }
        @Html.Raw(siteControl.GetElementValue("AdditionalHeadTagHTML"))
        }
    }
    <!-- start gift illustrator files -->
    <script type="text/javascript" src="//web.giftillustrator.com/Calculator/Production/scripts/jquery.noConflict.noniframe.js"></script>
    <script type="text/javascript" src="//web.giftillustrator.com/Calculator/Production/scripts/jquery.fancybox-1.3.4.pack.js"></script>
    <script type="text/javascript" src="//web.giftillustrator.com/Calculator/Production/scripts/custom.fancybox.noniframe.js"></script>
    <link rel="stylesheet" type="text/css" href="//web.giftillustrator.com/Calculator/Production/css/jquery.fancybox-1.3.4.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="//web.giftillustrator.com/Calculator/Production/css/custom.fancybox.css" media="screen" />
    <!-- end gift illustrator files -->
</head>
<body class="@page.RootElementName @(siteControl != null ? siteControl.GetElementValue("BodyClass") : "") @page.GetAttributeValue("Name").ToLower().Replace(" ", "-")" @Html.Raw(siteControl != null && siteControl.GetElementValue("BodyId") != "" ? "id=\"" + siteControl.GetElementValue("BodyId") + "\"" : "")>
    <a href="@Request.Url#skip" class="sr-only">Skip to Content</a>

    @RenderBody()
    <!-- #footer -->
    @if (siteControl != null)
    {
        ICMSElement addlHtmlInfo = siteControl.Element("AdditionalHTMLinfo");
        if (addlHtmlInfo != null && addlHtmlInfo.Value.Length > 0)
        {
        @Html.Raw(addlHtmlInfo.Value)
        }
        //render flyover
        Html.RenderPartial("Components/FlyOverComponent", page);
        Html.RenderPartial("Other/PEPCForm", page);
    }
    <!-- SiteCatalyst code version: H.25.2.
    Copyright 1996-2012 Adobe, Inc. All Rights Reserved
    More info available at http://www.omniture.com -->
    <script language="JavaScript" type="text/javascript"><!--
    s.pageName = document.title
    s.server = window.location.host
    s.channel = "planned giving"
    s.campaign = s.getQueryParam('src')
    s.eVar16 = s.getQueryParam('formName')
    s.prop17 = orgId
    s.eVar27 = s.getQueryParam('et_firstName')
    s.eVar28 = s.getQueryParam('et_lastName')
    s.eVar29 = s.getQueryParam('et_email')
    s.eVar30 = s.getQueryParam('et_donorID')
    s.eVar31 = s.getQueryParam('et_subscriberKey')
    s.eVar32 = s.getQueryParam('et_misc1')
    s.eVar33 = s.getQueryParam('et_misc2')
    s.eVar34 = s.getQueryParam('et_misc3')
    s.eVar35 = s.getQueryParam('et_misc4')
    s.eVar36 = s.getQueryParam('et_misc5')
    s.eVar38 = s.getQueryParam('et_sendId')
    if (s.getQueryParam('featured') == "true") { s.events = s.apl(s.events, "event6", ",", 2); s.eVar18 = "Home Page Special Feature"; }
    var pageurl = location.href.replace(/^(?:\/\/|[^\/]+)*\//, "");
    var pagename = "";
    if (pageurl.indexOf("?") < 0) {
        if (pageurl.lastIndexOf("/") < 0) {
            pagename = pageurl;
        } else {
            pagename = pageurl.substr(pageurl.lastIndexOf("/") + 1);
        }
    } else {
        if (pageurl.lastIndexOf("/") < 0) {
            pagename = pageurl.substring(0, pageurl.indexOf("?"));
        } else {
            pagename = pageurl.substring(pageurl.lastIndexOf("/") + 1, pageurl.indexOf("?"));
        }
    }
    s.prop4 = pagename;
    /************* DO NOT ALTER ANYTHING BELOW THIS LINE ! **************/
    var s_code = s.t(); if (s_code) document.write(s_code)//--></script>
    <script language="JavaScript" type="text/javascript"><!--
    if (navigator.appVersion.indexOf('MSIE') >= 0) document.write(unescape('%3C') + '\!-' + '-')
    //--></script>
    <noscript>
        <img src="http://thesteltercompany.d1.sc.omtrdc.net/b/ss/tsc-msu-dev/1/H.25.2--NS/0"
            height="1" width="1" border="0" alt="" />
    </noscript>
    <!--/DO NOT REMOVE/-->
    <!-- End SiteCatalyst code version: H.25.2. -->
</body>
</html>
