@model Ingeniux.Runtime.ICMSElement
@using Ingeniux.Runtime
@{
    ICMSNavigationElement vertNav = Model.GetNavigation("VerticalNavigation");
    ICMSElement home = Model.Element("Page", "HomeLink");
    var plannedGivingHomeLnk = home.GetAttributeValue("URL");

    string elemId = Convert.ToString(ViewData["ContainerId"]);
    string elemClass = Convert.ToString(ViewData["ContainerClass"]);
    string elemLocalStyle = Convert.ToString(ViewData["ContainerLocalStyle"]);

    <div id="@elemId" class="navigation section-nav @elemClass" style="@elemLocalStyle">
	    <ul id="rightnav" class="rtnav">
        @foreach (ICMSElement lnk in Model.Elements("Page", "VerticalNavigationLink"))
        {
            var linkTitle = lnk.GetAttributeValue("Link");
            var linkURL = lnk.GetAttributeValue("URL");
            var target = lnk.GetAttributeValue("Target");
            if (linkURL == "<#vertical_navigation>")
            {
                <li>
                @{
                    string lastElementID = "";
                    ICMSLinkElement lastElement = vertNav.GetLinkItems("", true).LastOrDefault(s => s.Schema == "VerticalNavigationGroup");
                    if (lastElement != null)
                    {
                        lastElementID = lastElement.GetAttributeValue("ID");
                    }
                    foreach (ICMSLinkElement link in vertNav.GetLinkItems())
                    {
                        if (link.Schema == "VerticalNavigationGroup")
                        {
                            <ul class="vertNavGroup">
                            <li class="onTrail currentPage">
                            @if (link.GetAttributeValue("ShowGroupName").Equals("true"))
                            {
                                <a>@link.Name</a>
                            }
                            @if (link.GetLinkItems().Count() > 0)
                            {
                                <ul>
                                @foreach (ICMSLinkElement sublink in link.GetLinkItems("", true))
                                {
                                    <li><a href="@sublink.URL">@sublink.Name</a></li>
                                }
                                </ul>
                            }
                            </li>
                            </ul>
                            if (lastElementID.Equals(link.GetAttributeValue("ID")))
                            {
                                <li style="display:none;" class="navGroupDivider"></li>
                            }
                        }
                    }
                }
                </li>
            }
            else
            {
                if (plannedGivingHomeLnk == linkURL)
                {
                    <li class="sectionhome currentPage">
					    <div>
                            <a class="stlHomelink" target="@target" href="@linkURL">@linkTitle</a>
                        </div>
				    </li>
                }
                else
                {
                    <li>
                        <a target="@target" href="@linkURL">@linkTitle</a>
                    </li>
                }
            }
        }
        </ul>
    </div>
    <div class="vertical-nav-divider hidden-sm"></div>
}